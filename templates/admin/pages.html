<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.metadata.title }} | {{ site.title }}</title>
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body class="admin-body">
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-container">
            <div class="admin-header-content">
                <h1 class="admin-title">
                    <a href="/admin">{{ site.title }} Admin</a>
                </h1>
                
                <nav class="admin-nav">
                    <ul>
                        <li><a href="/admin">Dashboard</a></li>
                        <li><a href="/admin/pages" class="active">Pages</a></li>
                        <li><a href="/admin/media">Media</a></li>
                    </ul>
                </nav>
                
                <div class="admin-user">
                    <span class="admin-username">{{ user.username }}</span>
                    <form method="POST" action="/admin/logout" class="admin-logout-form">
                        <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                        <button type="submit" class="admin-logout-btn">Logout</button>
                    </form>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="admin-main">
        <div class="admin-container">
            <div class="admin-dashboard-header">
                <h1>Manage Pages</h1>
                <p>Create, edit, and manage your content pages.</p>
            </div>

            <!-- Success/Error Messages -->
            {% if savedMessage %}
            <div class="admin-alert admin-alert-success">
                <h3>Page Saved</h3>
                <p>The page "{{ savedMessage }}" has been saved successfully.</p>
            </div>
            {% endif %}

            {% if deletedMessage %}
            <div class="admin-alert admin-alert-success">
                <h3>Page Deleted</h3>
                <p>The page "{{ deletedMessage }}" has been deleted successfully.</p>
            </div>
            {% endif %}

            <!-- Actions Bar -->
            <div class="admin-card">
                <div class="admin-card-header">
                    <h3>Page Actions</h3>
                </div>
                <div class="admin-card-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <form method="GET" action="/admin/pages" style="flex: 1;">
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" name="search" value="{{ search }}" placeholder="Search pages..." 
                                       style="flex: 1; padding: 0.5rem; border: 1px solid #ced4da; border-radius: 4px;">
                                <button type="submit" class="admin-btn admin-btn-outline admin-btn-small">Search</button>
                                {% if search %}
                                <a href="/admin/pages" class="admin-btn admin-btn-secondary admin-btn-small">Clear</a>
                                {% endif %}
                            </div>
                        </form>
                        <a href="/admin/pages/new" class="admin-btn admin-btn-primary">Create New Page</a>
                    </div>
                </div>
            </div>

            <!-- Pages List -->
            {% if pages.length > 0 %}
            <div class="admin-card">
                <div class="admin-card-header">
                    <h3>Pages ({{ pagination.total }} total{% if search %}, filtered by "{{ search }}"{% endif %})</h3>
                </div>
                <div class="admin-card-content" style="padding: 0;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f8f9fa; border-bottom: 1px solid #dee2e6;">
                                <th style="padding: 1rem; text-align: left; font-weight: 600; color: #343a40;">Title</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600; color: #343a40;">Slug</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600; color: #343a40;">Last Modified</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600; color: #343a40;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for page in pages %}
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                <td style="padding: 1rem;">
                                    <strong>{{ page.metadata.title or page.slug }}</strong>
                                    {% if page.metadata.description %}
                                    <br><small class="admin-text-muted">{{ page.metadata.description | truncate(80) }}</small>
                                    {% endif %}
                                </td>
                                <td style="padding: 1rem;">
                                    <code style="background-color: #f8f9fa; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.85rem;">
                                        {{ page.slug }}
                                    </code>
                                </td>
                                <td style="padding: 1rem;">
                                    <span class="admin-text-small">{{ page.lastModified | date }}</span>
                                    {% if page.metadata.date %}
                                    <br><span class="admin-text-muted admin-text-small">Published: {{ page.metadata.date | date }}</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 1rem;">
                                    <div style="display: flex; gap: 0.5rem;">
                                        <a href="/{{ page.slug }}" target="_blank" class="admin-btn admin-btn-outline admin-btn-small">View</a>
                                        <a href="/admin/pages/{{ page.slug }}/edit" class="admin-btn admin-btn-secondary admin-btn-small">Edit</a>
                                        <form method="POST" action="/admin/pages/{{ page.slug }}/delete" style="display: inline;">
                                            <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                                            <button type="submit" class="admin-btn admin-btn-outline admin-btn-small" 
                                                    data-confirm="Are you sure you want to delete '{{ page.metadata.title or page.slug }}'? This action cannot be undone."
                                                    style="color: #dc3545; border-color: #dc3545;">Delete</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            {% if pagination.totalPages > 1 %}
            <div class="admin-card">
                <div class="admin-card-content">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div class="admin-text-small admin-text-muted">
                            Showing {{ ((pagination.currentPage - 1) * pagination.limit) + 1 }} to 
                            {{ (pagination.currentPage * pagination.limit) if (pagination.currentPage * pagination.limit) < pagination.total else pagination.total }} 
                            of {{ pagination.total }} pages
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            {% if pagination.hasPrev %}
                            <a href="/admin/pages?page={{ pagination.prevPage }}{% if search %}&search={{ search }}{% endif %}" 
                               class="admin-btn admin-btn-outline admin-btn-small">Previous</a>
                            {% endif %}
                            
                            {% for pageNum in range(1, pagination.totalPages + 1) %}
                                {% if pageNum == pagination.currentPage %}
                                <span class="admin-btn admin-btn-primary admin-btn-small">{{ pageNum }}</span>
                                {% elif pageNum == 1 or pageNum == pagination.totalPages or (pageNum >= pagination.currentPage - 2 and pageNum <= pagination.currentPage + 2) %}
                                <a href="/admin/pages?page={{ pageNum }}{% if search %}&search={{ search }}{% endif %}" 
                                   class="admin-btn admin-btn-outline admin-btn-small">{{ pageNum }}</a>
                                {% elif pageNum == pagination.currentPage - 3 or pageNum == pagination.currentPage + 3 %}
                                <span class="admin-btn admin-btn-outline admin-btn-small" style="cursor: default;">...</span>
                                {% endif %}
                            {% endfor %}
                            
                            {% if pagination.hasNext %}
                            <a href="/admin/pages?page={{ pagination.nextPage }}{% if search %}&search={{ search }}{% endif %}" 
                               class="admin-btn admin-btn-outline admin-btn-small">Next</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            {% else %}
            <div class="admin-card">
                <div class="admin-card-content" style="text-align: center; padding: 3rem;">
                    {% if search %}
                    <h3>No pages found</h3>
                    <p class="admin-text-muted">No pages match your search for "{{ search }}".</p>
                    <a href="/admin/pages" class="admin-btn admin-btn-outline">View All Pages</a>
                    {% else %}
                    <h3>No pages yet</h3>
                    <p class="admin-text-muted">Get started by creating your first page.</p>
                    <a href="/admin/pages/new" class="admin-btn admin-btn-primary">Create Your First Page</a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </main>

    <!-- Admin Footer -->
    <footer class="admin-footer">
        <div class="admin-container">
            <p>&copy; 2024 {{ site.title }}. Powered by Stack Blog.</p>
        </div>
    </footer>

    <script src="/js/admin.js"></script>
</body>
</html>