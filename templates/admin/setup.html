<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site.title }} - Initial Setup</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body class="admin-body">
    <main class="admin-main">
        <div class="admin-container">
            <div class="admin-setup">
                <div class="admin-setup-container">
                    <div class="admin-setup-header">
                        <h1>{{ site.title }}</h1>
                        <h2>Initial Setup</h2>
                        <p>Welcome! Let's set up your admin password to get started.</p>
                    </div>

                    <div id="setup-form" class="admin-setup-form">
                        <div class="admin-form-group">
                            <label for="password">Admin Password</label>
                            <input 
                                type="password" 
                                id="password" 
                                name="password" 
                                required 
                                autocomplete="new-password"
                                placeholder="Enter a strong password"
                            >
                            <div class="admin-form-help">
                                Password must be at least 8 characters and include uppercase, lowercase, number, and special character.
                            </div>
                        </div>

                        <div class="admin-form-group">
                            <label for="confirm-password">Confirm Password</label>
                            <input 
                                type="password" 
                                id="confirm-password" 
                                name="confirm-password" 
                                required 
                                autocomplete="new-password"
                                placeholder="Confirm your password"
                            >
                        </div>

                        <button type="button" id="generate-hash" class="admin-btn admin-btn-primary">Generate Password Hash</button>
                    </div>

                    <div id="setup-result" class="admin-setup-result" style="display: none;">
                        <div class="admin-alert admin-alert-success">
                            <h3>Password Hash Generated!</h3>
                            <p>Add the following line to your <code>.env</code> file:</p>
                            <div class="admin-code-block">
                                <code id="password-hash-output"></code>
                                <button type="button" id="copy-hash" class="admin-btn admin-btn-small">Copy</button>
                            </div>
                            <p class="admin-text-small">After adding this to your .env file, restart the server and you can log in with your chosen password.</p>
                        </div>
                        
                        <div class="admin-setup-actions">
                            <a href="/admin/login" class="admin-btn admin-btn-secondary">Go to Login</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.getElementById('generate-hash').addEventListener('click', async function() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (!password || !confirmPassword) {
                alert('Please fill in both password fields.');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match.');
                return;
            }
            
            try {
                const response = await fetch('/admin/setup-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('password-hash-output').textContent = `ADMIN_PASSWORD_HASH=${result.hash}`;
                    document.getElementById('setup-form').style.display = 'none';
                    document.getElementById('setup-result').style.display = 'block';
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Network error: ' + error.message);
            }
        });
        
        document.getElementById('copy-hash').addEventListener('click', function() {
            const text = document.getElementById('password-hash-output').textContent;
            navigator.clipboard.writeText(text).then(function() {
                this.textContent = 'Copied!';
                setTimeout(() => {
                    this.textContent = 'Copy';
                }, 2000);
            }.bind(this));
        });
    </script>
</body>
</html>